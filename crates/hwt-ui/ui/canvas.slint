// Canvas Component
// Main editing area - placeholder for Bevy integration

import { Theme } from "theme.slint";

export component Canvas inherits Rectangle {
    in property <bool> show-grid: true;
    in property <float> zoom: 1.0;
    in property <float> pan-x: 0.0;
    in property <float> pan-y: 0.0;
    
    callback mouse-moved(float, float);
    callback mouse-pressed(float, float);
    callback mouse-released(float, float);
    callback zoom-changed(float);
    callback pan-changed(float, float);
    
    background: Theme.bg-primary;
    
    // Grid overlay (simplified - real grid would be in Bevy)
    if show-grid: Rectangle {
        // Grid pattern would be rendered by Bevy
    }
    
    // Placeholder content
    VerticalLayout {
        alignment: center;
        
        Text {
            text: "ðŸŽ¨";
            font-size: 64px;
            horizontal-alignment: center;
            color: Theme.text-disabled;
        }
        
        Text {
            text: "Canvas Area";
            font-size: 24px;
            horizontal-alignment: center;
            color: Theme.text-tertiary;
        }
        
        Text {
            text: "Bevy 3D renderer will be embedded here";
            font-size: 14px;
            horizontal-alignment: center;
            color: Theme.text-disabled;
        }
        
        Text {
            text: "Zoom: " + round(zoom * 100) + "%";
            font-size: 12px;
            horizontal-alignment: center;
            color: Theme.text-disabled;
        }
    }
    
    // Mouse interaction
    ta := TouchArea {
        moved => {
            root.mouse-moved(self.mouse-x / 1px, self.mouse-y / 1px);
        }
        
        pointer-event(e) => {
            if e.kind == PointerEventKind.down {
                root.mouse-pressed(self.mouse-x / 1px, self.mouse-y / 1px);
            } else if e.kind == PointerEventKind.up {
                root.mouse-released(self.mouse-x / 1px, self.mouse-y / 1px);
            }
        }
        
        scroll-event(e) => {
            // Zoom with scroll wheel
            if e.delta-y != 0px {
                root.zoom-changed(zoom * (1.0 + (e.delta-y / 100px)));
            }
            return accept;
        }
    }
}

export component Floating3DPanel inherits Rectangle {
    in property <bool> maximized: false;
    
    callback maximize-clicked;
    callback close-clicked;
    
    // Default size for floating mode (parent can override for maximized)
    min-width: 320px;
    min-height: 240px;
    
    background: Theme.bg-secondary;
    border-radius: maximized ? 0px : Theme.radius-lg;
    border-width: 1px;
    border-color: Theme.border-default;
    
    drop-shadow-blur: maximized ? 0px : 16px;
    drop-shadow-color: maximized ? transparent : #00000040;
    drop-shadow-offset-y: maximized ? 0px : 4px;
    
    VerticalLayout {
        // Header
        Rectangle {
            height: 32px;
            background: Theme.bg-tertiary;
            border-radius: Theme.radius-lg;
            
            HorizontalLayout {
                padding-left: Theme.spacing-md;
                padding-right: Theme.spacing-sm;
                
                Text {
                    text: "3D Preview";
                    color: Theme.text-primary;
                    font-size: 12px;
                    font-weight: 500;
                    vertical-alignment: center;
                }
                
                Rectangle { }
                
                // Maximize button
                Rectangle {
                    width: 24px;
                    height: 24px;
                    background: max-ta.has-hover ? Theme.bg-elevated : transparent;
                    border-radius: Theme.radius-sm;
                    
                    Text {
                        text: maximized ? "â" : "â¬œ";
                        font-size: 12px;
                        color: Theme.text-secondary;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                    
                    max-ta := TouchArea {
                        clicked => { root.maximize-clicked(); }
                    }
                }
                
                // Close button
                Rectangle {
                    width: 24px;
                    height: 24px;
                    background: close-ta.has-hover ? Theme.error.with-alpha(0.2) : transparent;
                    border-radius: Theme.radius-sm;
                    
                    Text {
                        text: "âœ•";
                        font-size: 12px;
                        color: close-ta.has-hover ? Theme.error : Theme.text-secondary;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                    
                    close-ta := TouchArea {
                        clicked => { root.close-clicked(); }
                    }
                }
            }
        }
        
        // 3D viewport placeholder
        Rectangle {
            background: #1a1a2e;
            
            VerticalLayout {
                alignment: center;
                
                Text {
                    text: "ðŸŽ²";
                    font-size: 48px;
                    horizontal-alignment: center;
                    color: Theme.text-disabled;
                }
                
                Text {
                    text: "3D Viewport";
                    font-size: 14px;
                    horizontal-alignment: center;
                    color: Theme.text-tertiary;
                }
                
                Text {
                    text: "Bevy renderer";
                    font-size: 11px;
                    horizontal-alignment: center;
                    color: Theme.text-disabled;
                }
            }
        }
    }
}
